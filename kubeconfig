What is a Kubeconfig File?
###########################

=> A Kubeconfig file is a YAML configuration file that tells kubectl how to reach and authenticate to one or more Kubernetes clusters. 
It contains configuration information (cluster address, authentication information, and the default namespace ) required to access Kubernetes clusters.
It is used by the kubectl command-line tool to determine which cluster to communicate with, how to authenticate, and which namespace to operate in by default.

=> When a kubectl command is executed, it reads this file to connect to the Kubernetes API server and perform the requested operation.

=> By default, kubectl searches for the kubeconfig file in these locations:  
    Linux / macOS: ~/.kube/config
    Windows: %USERPROFILE%\.kube\config

=> If needed, a different kubeconfig file can be used by passing the --kubeconfig option OR by setting the KUBECONFIG environment variable. This is especially useful when working with multiple Kubernetes clusters.

1. Using the KUBECONFIG environment variable
KUBECONFIG=/my/kubeconfig kubectl get pods

2. Using the --kubeconfig flag
kubectl get pods --kubeconfig /my/kubeconfig

Structure of the Kubeconfig File
####################################

The kubeconfig file is divided into several key sections, each serving a specific purpose:

clusters: Defines the clusters that kubectl can connect to.

users: Defines the users (or service accounts) that can authenticate against the clusters.

contexts: Binds a cluster, a user, and a namespace into a single configuration that kubectl can switch between.

current-context: Defines which context is currently active, determining which cluster, user, and namespace kubectl will use.

a. Clusters
=============
    The clusters section contains the connection details for each Kubernetes cluster.  Each cluster is identified by a unique name, and its configuration includes the server field, which is the URL of the cluster's API server. The certificate-authority field specifies the path to the CA certificate used to verify the API server's certificate.

    This section tells kubectl which Kubernetes clusters exist and how to reach them. Each entry has:
    
    #  name: This is the human-friendly and  A unique identifier for the cluster. You’ll use this to reference the cluster later. 
    
    #  certificate-authority: This is the path to the CA (certificate authority) file that validates the Kubernetes API server's identity. Without this, you might be chatting with a stranger (not good!).
    
    #  server: The URL for the cluster’s API server.
    
    | Field                        | Type   | Required | Description                          |
    | ---------------------------- | ------ | -------- | ------------------------------------ |
    | `server`                     | string | Yes      | API server URL                       |
    | `certificate-authority`      | string | No       | Path to CA file for TLS verification |
    | `certificate-authority-data` | string | No       | Base64-encoded CA data               |
    | `insecure-skip-tls-verify`   | bool   | No       | Skip TLS verification (insecure)     |
    | `extensions`                 | list   | No       | Optional metadata for the cluster    |
    
    => certificate-authority vs certificate-authority-data
    =======================================================
    
     #  certificate-authority (File-based CA):
    ===========================================
    
        The certificate-authority field specifies the path to the file containing the Certificate Authority (CA) certificate. 
        This CA certificate is used by kubectl to verify the authenticity of the Kubernetes API server it is communicating with.
    
        Purpose: It ensures that kubectl is talking to the real Kubernetes API server and not an impersonator.
    
        Format: This field holds a reference to a file path that contains the CA certificate in PEM format.
    
        clusters:
        - cluster:
            certificate-authority: /etc/kubernetes/pki/ca-prod.crt
            server: https://prod-cluster-api.example.com:6443
          name: prod-cluster
    
        In this example, the kubectl client will read the CA certificate from /etc/kubernetes/pki/ca-prod.crt to verify the server's identity.
    
    #  certificate-authority-data (Embedded Base64-encoded CA):
    ===========================================================
    
    The certificate-authority-data field is used to embed the actual CA certificate directly in the kubeconfig file as a Base64-encoded string. 
    This eliminates the need for a separate file on disk. 
    It’s particularly useful when you want to distribute a kubeconfig file that contains everything necessary to connect to the Kubernetes API, without needing extra files.
    
    Purpose: It allows the CA certificate to be included directly in the kubeconfig file, avoiding the need to reference an external file.
    
    Format: The CA certificate is embedded as a Base64-encoded string.
    
    clusters:
    - cluster:
        certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JS...
        server: https://staging-cluster-api.example.com:6443
      name: staging-cluster
    
    In this example, the CA certificate is directly included in the kubeconfig as a Base64 string, ensuring the certificate is bundled with the config.
    
    Key Differences:
    =================
    
    File-based (certificate-authority): Refers to a certificate stored in a file on the local filesystem.
    
    Embedded (certificate-authority-data): Contains the certificate inline as a Base64 string within the kubeconfig itself.

B. users
=========
        The users section specifies the credentials for authenticating to the clusters. 
        Users can be defined using various authentication methods, such as client certificates, bearer tokens, or even basic authentication (though not recommended for production).
        
        In this example, user-1 uses a client certificate and key for authentication.
        
        users:
        - name: user-1
          user:
            client-certificate: /path/to/client.crt
            client-key: /path/to/client.key
        
        name: A unique identifier for the user.
        
        client-certificate: The path to the user's client certificate.
        
        client-key: The path to the user's private key.
        
        Authentication can also be configured using tokens, username/password, or external providers like OIDC
        
        
        
        users:
        - name: user-1
          user:
            client-certificate: /path/to/client.crt
            client-key: /path/to/client.key
        - name: user-2
          user:
            token: eyJhbGciOi...
        - name: gke-user
          user:
            auth-provider:
              name: gcp
              config:
                access-token: ya29.c.Kp...
        - name: eks-user
          user:
            exec:
              apiVersion: client.authentication.k8s.io/v1beta1
              command: aws
              args:
                - "eks"
                - "get-token"
                - "--cluster-name"
                - "my-cluster"

        
        | Field                     | Type       | Description                                                                                                                                                                      |
        | ------------------------- | ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
        | `client-certificate`      | string     | Path to the client certificate file (X.509) for TLS authentication.                                                                                                              |
        | `client-certificate-data` | string     | Base64-encoded client certificate data (instead of a file).                                                                                                                      |
        | `client-key`              | string     | Path to the client key file (private key for TLS authentication).                                                                                                                |
        | `client-key-data`         | string     | Base64-encoded client key data (instead of a file).                                                                                                                              |
        | `token`                   | string     | Bearer token used for authentication (e.g., a service account token).                                                                                                            |
        | `username`                | string     | Username for basic authentication (less common; not recommended).                                                                                                                |
        | `password`                | string     | Password for basic authentication (less common; not recommended).                                                                                                                |
        | `auth-provider`           | map/object | Configuration for an **authentication plugin**, e.g., GCP, Azure, or OIDC. Example: `auth-provider: { name: gcp }`.                                                              |
        | `exec`                    | map/object | Configuration to **run an external command** to get credentials. Used for EKS, GKE, or other dynamic credentials. Example: `exec: { command: aws, args: ["eks", "get-token"] }`. |
        | `extensions`              | list       | Optional metadata for the user; rarely used.                                                                                                                                     |

C. Contexts
#############
    “A context connects a user to a cluster and can set a default namespace” means:
        
        # A context tells kubectl which cluster to talk to and which user credentials to use.
        # It can also specify a default namespace, so you don’t have to type --namespace every time.
        # Essentially, it’s like a profile for working in a specific cluster with a specific user and namespace.

        contexts:
        - name: context-1
          context:
            cluster: cluster-1
            user: user-1
            namespace: default
        
        Here, context-1 connects to cluster-1 using user-1 and sets the default namespace to default.
        
        name: A unique identifier for the context.
        
        cluster: The name of the cluster to connect to.
        
        user: The name of the user to authenticate as.
        
        namespace: The default namespace to use (optional).

D. Current-context
####################

The current-context field shows which context is active. kubectl uses this context for commands unless you choose a different one.
current-context: The context that kubectl is using right now. It tells kubectl which cluster, user, and namespace to apply commands to by default.

current-context: context-1


EXAMPLE:
########
apiVersion: v1
kind: Config
clusters:
- name: cluster-1
  cluster:
    server: https://cluster-1-api-server:6443
    certificate-authority: /path/to/ca.crt
- name: cluster-2
  cluster:
    server: https://cluster-2-api-server:6443
    certificate-authority: /path/to/ca.crt
users:
- name: user-1
  user:
    client-certificate: /path/to/client.crt
    client-key: /path/to/client.key
- name: user-2
  user:
    token: abcdef123456
contexts:
- name: context-1
  context:
    cluster: cluster-1
    user: user-1
    namespace: default
- name: context-2
  context:
    cluster: cluster-2
    user: user-2
    namespace: development
current-context: context-1

Doc related to kubeconfig:
##########################
https://imransaifi.hashnode.dev/the-ins-and-outs-of-the-kubeconfig-file-in-kubernetes-a-complete-breakdown
https://devopscube.com/kubernetes-kubeconfig-file/
https://devopscube.com/kubernetes-architecture-explained/
https://spacelift.io/blog/kubeconfig#the-benefits-of-using-a-kubeconfig-file
https://www.plural.sh/blog/where-to-find-kubeconfig/
https://anju-chaurasiya2012.medium.com/mastering-the-kubeconfig-file-a-friendly-guide-268c1473e94f
https://www.redhat.com/en/blog/kubeconfig

Youtube:
https://www.youtube.com/watch?v=a29WfixUA9Y
https://www.youtube.com/watch?v=JjuZbUPKspM
https://www.youtube.com/watch?v=Q74gSxeO4cI
https://www.youtube.com/watch?v=Q74gSxeO4cI
https://www.youtube.com/watch?v=8E_sS-bbs5g

Kubectl commands related to this:
#################################
Modify kubeconfig files using subcommands like "kubectl config set current-context my-context".

 The loading order follows these rules:

  1.  If the --kubeconfig flag is set, then only that file is loaded. The flag may only be set once and no merging takes
place.
  2.  If $KUBECONFIG environment variable is set, then it is used as a list of paths (normal path delimiting rules for
your system). These paths are merged. When a value is modified, it is modified in the file that defines the stanza. When
a value is created, it is created in the first file that exists. If no files in the chain exist, then it creates the
last file in the list.
  3.  Otherwise, ${HOME}/.kube/config is used and no merging takes place.

Available Commands:
  current-context   Display the current-context
  delete-cluster    Delete the specified cluster from the kubeconfig
  delete-context    Delete the specified context from the kubeconfig
  delete-user       Delete the specified user from the kubeconfig
  get-clusters      Display clusters defined in the kubeconfig
  get-contexts      Describe one or many contexts
  get-users         Display users defined in the kubeconfig
  rename-context    Rename a context from the kubeconfig file
  set               Set an individual value in a kubeconfig file
  set-cluster       Set a cluster entry in kubeconfig
  set-context       Set a context entry in kubeconfig
  set-credentials   Set a user entry in kubeconfig
  unset             Unset an individual value in a kubeconfig file
  use-context       Set the current-context in a kubeconfig file
  view              Display merged kubeconfig settings or a specified kubeconfig file

Usage:
  kubectl config SUBCOMMAND [options]

Use "kubectl config <command> --help" for more information about a given command.
Use "kubectl options" for a list of global command-line options (applies to all commands).


Merging Multiple kubeconfig Files: 
















